# pyecharts V0.5.0 发布日志

> pyecharts V0.5.0 发布，这是一个重大更新的版本。

## 1.重构 option 配置项代码

为了使代码结构更加合理，将关于 echarts 配置项逻辑相关部分的代码文件移动至新的包 `echarts` 中，并重构了 `option.py` 文件的代码，将其中 `axis`，`label`，`line` 配置部分抽象成单独的类。


## 2.新增对 JavaScript 回调函数的支持

v0.5.0 引入了新的 pyecharts 扩展包 [pyecharts-javascripthon](https://github.com/pyecharts/pyecharts-javascripthon)，该包的引入为 pyecharts 注入了新的活力。先来介绍一下这个包，pyecharts-javascripthon 是使用了一个优秀的第三方 Python 库 [metapensiero.pj](https://github.com/metapensiero/metapensiero.pj)，该库的官方介绍是 `Javascript for refined palates: a Python 3 to ES6 Javascript translator`，很明显了，这是一个用于将 python 函数转换为 js 函数的工具。

下面是几个简单的示例，

python 代码

``` python
def foo(a, b, c):
    pass
```
经转换，成为
``` js
function foo(a, b, c) {
}
```

python 代码

```python
def foo(a, b, c):
    for i in range(a, b, c):
        yield i

for i in iterable(foo(0, 5, 2)):
    print(i)
```
经转换，成为
``` js
function* foo(a, b, c) {
    for ... { // loop control omitted for brevity
        yield i;
    }
}

for (var i of foo(0, 5, 2)) {
    console.log(i);
}
```

关于该库的更多用法就不在这里展开了，请用户移步至 [官方文档](https://github.com/metapensiero/metapensiero.pj) 进行更详细的了解。

有了这个库后，从本版本开始，pyecharts 将支持在配置项中传入 python Function 类型的参数，对应的 Function 将会在 render 时自动的被转换成 js 代码写入到 html 文件中，这也解决了 pyecharts 一直以来的一个痛点，缺乏对回调函数的支持，类似 formatter 这样的配置项一直无法得到较好的支持。

举个例子，pyecharts 用户经常会提问 Geo 图中如何在 tooltip 中只显示地图坐标名称和数值，不显示经纬度。

像这样

![image_153](https://user-images.githubusercontent.com/19553554/39248236-186a50ae-48ce-11e8-84eb-e58ba17eca5c.png)

而现在，你可以这么操作，先定义一个函数

```python
def geo_formatter(params):
    return params.name + ' : ' + params.value[2]
```

然后设置 `tooltip_formatter=geo_formatter`，就能得到这样的效果

![image_154](https://user-images.githubusercontent.com/19553554/39248244-1be6da4a-48ce-11e8-931f-059879c5dcf4.png)

本新功能需要用户对 metapensiero.pj 和 Echarts 官方配置项有一定的了解。

## 3.支持 JavaScript 原生事件